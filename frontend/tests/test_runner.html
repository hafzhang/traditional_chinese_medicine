<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½“è´¨è¯†åˆ«æµ‹è¯• - Constitution Recognition Tests</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e5e5e5;
        }

        .results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .test-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .test-pass {
            background: #d4edda;
            color: #155724;
        }

        .test-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #e9ecef;
            border-radius: 8px;
            margin-top: 20px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 32px;
            font-weight: 700;
        }

        .summary-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .pass { color: #28a745; }
        .fail { color: #dc3545; }

        .error-details {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-size: 13px;
            color: #856404;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 14px;
            color: #0c5460;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .test-details {
            margin-top: 20px;
        }

        .test-group {
            margin-bottom: 20px;
        }

        .test-group-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ä½“è´¨è¯†åˆ«ç®—æ³•æµ‹è¯•</h1>
        <p class="subtitle">Constitution Recognition Algorithm Tests</p>

        <div class="info-box">
            <strong>æµ‹è¯•å†…å®¹:</strong> ä¹ç§ä½“è´¨è¯„åˆ†ç®—æ³•ã€ç™¾åˆ†åˆ¶è½¬æ¢ã€ä½“è´¨åˆ¤å®šé€»è¾‘ã€è¾¹ç•Œæ¡ä»¶å¤„ç†ç­‰
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="runAllTests()">â–¶ï¸ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn-secondary" onclick="runScoringTests()">ğŸ“Š ä»…è¯„åˆ†æµ‹è¯•</button>
            <button class="btn-secondary" onclick="runDetermineTests()">ğŸ¯ ä»…åˆ¤å®šæµ‹è¯•</button>
            <button class="btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨è¿è¡Œæµ‹è¯•...</p>
        </div>

        <div class="results" id="results">
            <p style="color: #999; text-align: center; padding: 40px;">
                ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹
            </p>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <div class="summary-item">
                <div class="summary-value pass" id="passed">0</div>
                <div class="summary-label">é€šè¿‡</div>
            </div>
            <div class="summary-item">
                <div class="summary-value fail" id="failed">0</div>
                <div class="summary-label">å¤±è´¥</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="total">0</div>
                <div class="summary-label">æ€»è®¡</div>
            </div>
        </div>
    </div>

    <script src="constitution.test.js"></script>
    <script>
        // æµ‹è¯•åˆ†ç±»
        const testCategories = {
            scoring: [
                "å…¨é€‰1åˆ† - å„ä½“è´¨åŸå§‹åˆ†æ•°æ­£ç¡®",
                "å…¨é€‰5åˆ† - å„ä½“è´¨åŸå§‹åˆ†æ•°æ­£ç¡®",
                "ç™¾åˆ†åˆ¶è½¬æ¢ - è®¡ç®—æ­£ç¡®",
                "ç™¾åˆ†åˆ¶è½¬æ¢ - æœ€å¤§å€¼ä¸è¶…è¿‡100"
            ],
            determine: [
                "å¹³å’Œè´¨åˆ¤å®š - 60åˆ†ä¸”å…¶ä»–<40",
                "æ°”è™šè´¨åˆ¤å®š - åˆ†æ•°æœ€é«˜",
                "é˜³è™šè´¨åˆ¤å®š - æ‰‹è„šå‘å‡‰å…¸å‹ç—‡çŠ¶",
                "é˜´è™šè´¨åˆ¤å®š - å£å¹²å’½ç‡¥å…¸å‹ç—‡çŠ¶",
                "ç—°æ¹¿è´¨åˆ¤å®š - èƒ¸é—·è…¹èƒ€å…¸å‹ç—‡çŠ¶",
                "æ¹¿çƒ­è´¨åˆ¤å®š - é¢éƒ¨æ²¹è…»å…¸å‹ç—‡çŠ¶",
                "è¡€ç˜€è´¨åˆ¤å®š - çš®è‚¤ç˜€æ–‘å…¸å‹ç—‡çŠ¶",
                "æ°”éƒè´¨åˆ¤å®š - æƒ…ç»ªä½æ²‰å…¸å‹ç—‡çŠ¶",
                "æ¬¡è¦ä½“è´¨åˆ¤å®š - æ°”è™šé˜³è™šæ··åˆ",
                "æ— è¾¾åˆ°é˜ˆå€¼ - é€‰æ‹©åˆ†æ•°æœ€é«˜"
            ]
        };

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            showLoading(true);
            await new Promise(r => setTimeout(r, 100)); // è®©UIæ›´æ–°
            await runner.run();
            showLoading(false);
        }

        // ä»…è¿è¡Œè¯„åˆ†æµ‹è¯•
        async function runScoringTests() {
            showLoading(true);
            const scoringTests = runner.tests.filter(t =>
                testCategories.scoring.some(name => t.name.includes(name))
            );

            // ä¸´æ—¶æ›¿æ¢æµ‹è¯•åˆ—è¡¨
            const originalTests = runner.tests;
            runner.tests = scoringTests;
            runner.passed = 0;
            runner.failed = 0;

            await runner.run();

            runner.tests = originalTests;
            showLoading(false);
        }

        // ä»…è¿è¡Œåˆ¤å®šæµ‹è¯•
        async function runDetermineTests() {
            showLoading(true);
            const determineTests = runner.tests.filter(t =>
                testCategories.determine.some(name => t.name.includes(name))
            );

            const originalTests = runner.tests;
            runner.tests = determineTests;
            runner.passed = 0;
            runner.failed = 0;

            await runner.run();

            runner.tests = originalTests;
            showLoading(false);
        }

        // æ¸…ç©ºç»“æœ
        function clearResults() {
            document.getElementById('results').innerHTML =
                '<p style="color: #999; text-align: center; padding: 40px;">ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹</p>';
            document.getElementById('summary').style.display = 'none';
            runner.passed = 0;
            runner.failed = 0;
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // è¦†ç›–é»˜è®¤çš„ run æ–¹æ³•ä»¥æ›´æ–° UI
        const originalRun = runner.run.bind(runner);
        runner.run = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            console.log = function(message, ...args) {
                // æ•è· console.log å¹¶æ˜¾ç¤º
            };

            console.group = function(label) {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'test-group';
                const titleDiv = document.createElement('div');
                titleDiv.className = 'test-group-title';
                titleDiv.textContent = label;
                groupDiv.appendChild(titleDiv);
                groupDiv.currentContent = document.createElement('div');
                groupDiv.appendChild(groupDiv.currentContent);
                resultsDiv.appendChild(groupDiv);
                console.currentGroup = groupDiv;
            };

            console.groupEnd = function() {
                console.currentGroup = null;
            };

            const originalConsoleError = console.error;
            console.error = function(...args) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-details';
                errorDiv.textContent = args.join(' ');
                if (console.currentGroup) {
                    console.currentGroup.currentContent.appendChild(errorDiv);
                } else {
                    resultsDiv.appendChild(errorDiv);
                }
                originalConsoleError.apply(console, args);
            };

            for (let test of this.tests) {
                try {
                    await test.fn();
                    this.passed++;
                    addTestResult(test.name, true);
                } catch (error) {
                    this.failed++;
                    addTestResult(test.name, false, error.message);
                }
            }

            // æ¢å¤ console
            console.log = console.log.bind(console);
            console.error = originalConsoleError;

            updateSummary();
        };

        function addTestResult(name, passed, error = null) {
            const resultsDiv = document.getElementById('results');

            const testDiv = document.createElement('div');
            testDiv.className = 'test-item ' + (passed ? 'test-pass' : 'test-fail');

            const icon = passed ? 'âœ… ' : 'âŒ ';
            testDiv.textContent = icon + name;

            if (error) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-details';
                errorDiv.textContent = error;
                testDiv.appendChild(errorDiv);
            }

            if (console.currentGroup) {
                console.currentGroup.currentContent.appendChild(testDiv);
            } else {
                resultsDiv.appendChild(testDiv);
            }
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            summaryDiv.style.display = 'flex';

            document.getElementById('passed').textContent = runner.passed;
            document.getElementById('failed').textContent = runner.failed;
            document.getElementById('total').textContent = runner.passed + runner.failed;
        }

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ§ª ä½“è´¨è¯†åˆ«æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ’¡ å¯ç”¨å‡½æ•°:');
            console.log('  runAllTests() - è¿è¡Œæ‰€æœ‰æµ‹è¯•');
            console.log('  runScoringTests() - ä»…è¿è¡Œè¯„åˆ†æµ‹è¯•');
            console.log('  runDetermineTests() - ä»…è¿è¡Œåˆ¤å®šæµ‹è¯•');
            console.log('  clearResults() - æ¸…ç©ºç»“æœ');
        });
    </script>
</body>
</html>
